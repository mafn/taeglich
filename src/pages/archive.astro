---
import BaseLayout from "../layouts/BaseLayout.astro";
import type { DayMeta } from "../types";

const metas = import.meta.glob("../days/*/meta.ts", { eager: true });
const artifacts = import.meta.glob("../days/*/Artifact.astro");

const days = Object.keys(metas)
  .map((path) => {
    const date = path.split("/").at(-2)!;
    const metaModule = metas[path] as { default: DayMeta };
    return {
      date,
      ...metaModule.default,
    };
  })
  .filter((day) => artifacts[`../days/${day.date}/Artifact.astro`])
  .filter((day) => !day.draft)
  .sort((a, b) => b.date.localeCompare(a.date));

const canonicalURL = new URL("/archive", Astro.site);
---

<BaseLayout
  title="Taeglich Archive"
  renderH1={false}
  canonicalURL={canonicalURL}
>
  <div class="mx-auto max-w-2xl px-4 py-12">
    <header class="mb-12">
      <h1 class="text-3xl font-bold tracking-tight text-gray-900">Archive</h1>
      <p class="mt-2 text-lg text-gray-600">
        Daily digital artifacts. One per day. Frozen in time.
      </p>
    </header>

    <section>
      <ul class="space-y-4">
        {
          days.map((day) => (
            <li>
              <a
                href={`/d/${day.date}`}
                class="group block border-l-2 border-gray-100 pl-4 transition-colors hover:border-gray-900"
              >
                <div class="flex items-baseline justify-between">
                  <time
                    datetime={day.date}
                    class="font-mono text-sm text-gray-500"
                  >
                    {day.date}
                  </time>
                </div>
                <h2 class="text-lg font-medium text-gray-900 group-hover:underline">
                  {day.title}
                </h2>
              </a>
            </li>
          ))
        }
        {
          days.length === 0 && (
            <li class="py-8 text-center text-gray-500 italic">
              No artifacts yet. Check back tomorrow.
            </li>
          )
        }
      </ul>
    </section>
  </div>
</BaseLayout>
